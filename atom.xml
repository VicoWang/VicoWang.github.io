<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>VicoV的博客</title>
  
  <subtitle>无风自动</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2018-09-12T01:36:19.856Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>wangkun</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>手把手教你如何实现3d-Touch</title>
    <link href="http://yoursite.com/2015/10/29/3d-Touch/"/>
    <id>http://yoursite.com/2015/10/29/3d-Touch/</id>
    <published>2015-10-29T08:19:05.000Z</published>
    <updated>2018-09-12T01:36:19.856Z</updated>
    
    <content type="html"><![CDATA[<p>很久之前就想写一篇关于3D Touch的博客，因为各种原因一直到现在才开始写(其实就是懒&gt;_&lt;)。咳咳，趁着发呆时间赶紧来写一篇…<a href="https://github.com/VicoWang/3D-Touch" target="_blank" rel="noopener">demo请戳这里</a></p><a id="more"></a><hr><p>3D Touch分为以下三大模块：<br>1.Home Screen Quick Actions<br>2.Peek and Pop<br>3.UITouch</p><hr><h2 id="Home-Screen-Quick-Actions"><a href="#Home-Screen-Quick-Actions" class="headerlink" title="Home  Screen Quick Actions"></a>Home  Screen Quick Actions</h2><p>重按主界面应用图标后弹出的快捷菜单，例如重按微信会出现这样的效果。<br><img src="/2015/10/29/3d-Touch/20151029104541512.jpg"><br>实现Quick Actions分为两种：静态和动态。</p><h5 id="一、Static（静态）Quick-Actions"><a href="#一、Static（静态）Quick-Actions" class="headerlink" title="一、Static（静态）Quick Actions"></a>一、Static（静态）Quick Actions</h5><p>Static Quick Actions只需要我们在项目的info.plist文件中配置，在用户安装程序后就可以使用。<br>配置Static Quick Actions只需要在info.plist文件中添加如下键值。</p><p>1、必填项（下面两个键值是必须设置的）:<br>UIApplicationShortcutItemType 这个键值设置一个快捷通道类型的字符串<br>UIApplicationShortcutItemTitle   这个键值设置标签的标题<br>2、选填项（下面这些键值不是必须设置的）：<br>UIApplicationShortcutItemSubtitle    设置标签的副标题<br>UIApplicationShortcutItemIconType 设置标签Icon类型<br>UIApplicationShortcutItemIconFile   设置标签的Icon文件<br>UIApplicationShortcutItemUserInfo  设置信息字典(用于传值)<br><img src="/2015/10/29/3d-Touch/20151029110028849.jpg"><br>如图配置好info.plist文件之后，运行程序，真机上测试效果如下：<br><img src="/2015/10/29/3d-Touch/20151029110624536.jpg"></p><h5 id="二、Dynamic（动态）-Quick-Actions"><a href="#二、Dynamic（动态）-Quick-Actions" class="headerlink" title="二、Dynamic（动态） Quick Actions"></a>二、Dynamic（动态） Quick Actions</h5><p>Dynamic Quick Actions是我们在程序中通过代码添加，与之相关的类主要有3个：<br>UIApplicationShortcutItem 创建3DTouch action的类<br>UIMutableApplicationShortcutItem 创建可变的3DTouch action的类<br>UIApplicationShortcutIcon 创建标签中图片icon的类</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UIApplicationShortcutIcon *icon1 = [UIApplicationShortcutIcon iconWithType:UIApplicationShortcutIconTypeInvitation];</span><br><span class="line">UIMutableApplicationShortcutItem *item1 = [[UIMutableApplicationShortcutItem alloc]initWithType:@&quot;1&quot; localizedTitle:@&quot;么么哒&quot;];</span><br><span class="line">item1.icon = icon1;</span><br><span class="line"></span><br><span class="line">UIApplicationShortcutIcon *icon2 = [UIApplicationShortcutIcon iconWithType:UIApplicationShortcutIconTypeContact];</span><br><span class="line">UIApplicationShortcutItem *item2 = [[UIApplicationShortcutItem alloc]initWithType:@&quot;2&quot; localizedTitle:@&quot;萌萌哒&quot; localizedSubtitle:@&quot;看这里是不是想到了tableView&quot; icon:icon2 userInfo:nil</span><br><span class="line">];</span><br><span class="line">application.shortcutItems = @[item1,item2];</span><br></pre></td></tr></table></figure><p>我在application:didFinishLaunchingWithOptions:方法里面添加了以上代码，运行程序，真机测试的效果如下:<br><img src="/2015/10/29/3d-Touch/20151029112319649.jpg"><br>上述代码里面设置的icon不是UIImage，而是一个叫UIApplicationShortcutIcon的类。<br><img src="/2015/10/29/3d-Touch/20151029112659823.jpg"><br>API很简单吧~值得注意的是官方API里面的这句话：</p><blockquote><p>Icons should be square, single color, and 35x35 points, as shown in these template files and as described in Template Images in UIKit User Interface Catalog and in iOS Human Interface Guidelines.</p></blockquote><h5 id="三、Actions-被点击后的响应"><a href="#三、Actions-被点击后的响应" class="headerlink" title="三、Actions 被点击后的响应"></a>三、Actions 被点击后的响应</h5><p>类似推送，当我们点击Actions进入应用程序时，也可以进行一些操作，我们可以发现，在application中增加了这样一个方法：<br><img src="/2015/10/29/3d-Touch/20151029113210112.jpg"><br>当我们通过点击Actions进入app时，就会在appdelegate中调用这样一个回调，我们可以获取shortcutItem的信息进行相关逻辑操作。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (void)application:(UIApplication *)application performActionForShortcutItem:(UIApplicationShortcutItem *)shortcutItem completionHandler:(void (^)(BOOL))completionHandler &#123;</span><br><span class="line"></span><br><span class="line">if ([shortcutItem.localizedTitle isEqualToString:@&quot;New Message&quot;])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">UIAlertController *alertC = [UIAlertController alertControllerWithTitle:@&quot;老板&quot; message:@&quot;过来办公室，发妹子了&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">UIAlertAction *action = [UIAlertAction actionWithTitle:@&quot;马上就来&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">[alertC dismissViewControllerAnimated:YES completion:nil];</span><br><span class="line">&#125;];</span><br><span class="line">[alertC addAction:action];</span><br><span class="line">[self.window.rootViewController presentViewController:alertC animated:YES completion:nil];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">else if ([shortcutItem.localizedTitle isEqualToString:@&quot;Favorites&quot;])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">UINavigationController *naVC = (UINavigationController *)self.window.rootViewController;</span><br><span class="line">[naVC popToRootViewControllerAnimated:NO];</span><br><span class="line">ThirdViewController *thirdVC = [[ThirdViewController alloc]init];</span><br><span class="line">[naVC pushViewController:thirdVC animated:YES];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我在application: performActionForShortcutItem: completionHandler:方法里面写了这样一段代码，然后通过点击外界的New Message Action进入APP，就会走第一个if里面的语句，点击外界的Favorites Action进入APP，就会走第二个if里面的语句。真机测试效果如下:<br><img src="/2015/10/29/3d-Touch/20151029140226239.gif"></p><p>这里有一点需要注意：我们在app的入口函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions;</span><br></pre></td></tr></table></figure></p><p>需要进行一下判断，在luanchOptions中有个UIApplicationLaunchOptionsShortcutItemKey这样一个键，通过它，我们可以区别是否是从标签进入的APP，如果是则处理结束逻辑后，返回NO，防止处理逻辑被反复回调。</p><hr><h2 id="Peek-and-Pop"><a href="#Peek-and-Pop" class="headerlink" title="Peek and Pop"></a>Peek and Pop</h2><p>Peek and Pop实际上就是基于重按的两个操作：peek 和pop。使用场景是item的详细信息不能完全展示出来时，通过3D Touch来预览以及跳转至详情页。苹果在这方面的封装很严实，我们不能修改动画的样式，只能修改preview(预览)窗的高度。什么？不知道具体的效果？好吧，先带你们看一下Peek and Pop的效果。<br><img src="/2015/10/29/3d-Touch/20151029141318865.gif"></p><p>1、Peek<br>在第一次重按item时触发的操作，会弹出预览框。弹出预览框后，如果这时松手，那么预览框也会随即消失。<br>2、Pop<br>Peek操作完成后不松手，再次重按，就可以跳转至详情页了。在跳转至详情页的过程中，我们还可以看到一个轻微的纵向弹性动画。</p><p>看完了Peek and Pop 我们就来简单的实现一下吧。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//首先接受代理</span><br><span class="line">@interface ForthTableViewController () &lt;UIViewControllerPreviewingDelegate&gt;</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//然后在viewDidLoad里面注册一下registerForPreviewingWithDelegate:sourceView:</span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">[super viewDidLoad];</span><br><span class="line"></span><br><span class="line">//判断是否支持3D Touch，如果支持则需要注册一下</span><br><span class="line">if (self.traitCollection.forceTouchCapability == UIForceTouchCapabilityAvailable) &#123;</span><br><span class="line">[self registerForPreviewingWithDelegate:self sourceView:self.view];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//实现代理方法</span><br><span class="line">//Peek手势触发，进入预览界面</span><br><span class="line">- (nullable UIViewController *)previewingContext:(id &lt;UIViewControllerPreviewing&gt;)previewingContext viewControllerForLocation:(CGPoint)location</span><br><span class="line">&#123;</span><br><span class="line">NSIndexPath *indexPath = [self.tableView indexPathForRowAtPoint:location];</span><br><span class="line">UITableViewCell *cell  = [self.tableView cellForRowAtIndexPath:indexPath];</span><br><span class="line">previewingContext.sourceRect = cell.frame;</span><br><span class="line">ThirdViewController *childVC = [[ThirdViewController alloc] init];</span><br><span class="line">UILabel *label      = [[UILabel alloc]init];</span><br><span class="line">label.text          = cell.textLabel.text;</span><br><span class="line">label.textAlignment = NSTextAlignmentCenter;</span><br><span class="line">label.textColor     = [UIColor redColor];</span><br><span class="line">childVC.view        = label;</span><br><span class="line">childVC.view.backgroundColor = [UIColor whiteColor];</span><br><span class="line">childVC.preferredContentSize = CGSizeMake(0.0f,400.0f);</span><br><span class="line"></span><br><span class="line">return childVC;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//Pop手势触发，进入详情界面</span><br><span class="line">- (void)previewingContext:(id &lt;UIViewControllerPreviewing&gt;)previewingContext commitViewController:(UIViewController *)viewControllerToCommit</span><br><span class="line">&#123;</span><br><span class="line">[self showViewController:viewControllerToCommit sender:self];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码写到这里，真机运行一下看看效果：<br><img src="/2015/10/29/3d-Touch/20151029155243726.gif"><br>效果看起来还不错~~^_^</p><p>接下来我们想起来还有个家伙叫UIPreviewAction，它是Peek预览时上滑底部会出现的菜单。那么该如何添加预览时上滑底部的菜单呢？<br>只需要在我们创建的预览控制器(就是上方的ThirdViewController *childVC)里面重写一下如下这个方法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray &lt;id &lt;UIPreviewActionItem&gt;&gt; *)previewActionItems &#123;</span><br><span class="line">UIPreviewAction *p1 = [UIPreviewAction actionWithTitle:@&quot;点我!&quot;style:UIPreviewActionStyleDefault handler:^(UIPreviewAction * _Nonnull action, UIViewController * _Nonnull previewViewController) &#123;</span><br><span class="line"></span><br><span class="line">NSLog(@&quot;点击了点我!&quot;);</span><br><span class="line">&#125;];</span><br><span class="line">UIPreviewAction *p2 = [UIPreviewAction actionWithTitle:@&quot;别点我!&quot; style:UIPreviewActionStyleDefault handler:^(UIPreviewAction * _Nonnull action, UIViewController * _Nonnull previewViewController) &#123;</span><br><span class="line"></span><br><span class="line">NSLog(@&quot;点击了别点我!&quot;);</span><br><span class="line">&#125;];</span><br><span class="line">NSArray *actions = @[p1,p2];</span><br><span class="line">return actions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我写的代码如上所示，然后直接真机跑起来看看效果：<br><img src="/2015/10/29/3d-Touch/20151029160817411.gif"></p><hr><h2 id="UITouch"><a href="#UITouch" class="headerlink" title="UITouch"></a>UITouch</h2><p>UITouch里面多了两个API，分别是力度和最大力度。这个就可以很个性化地做一些酷炫的交互操作了！没啥好说的，touch.force和touch.maximumPossibleForce。大家可以在官方API里面很容易找到他们。看一下就哦了。<br><img src="/2015/10/29/3d-Touch/20151029161500146.jpg"></p><hr><blockquote><p>结束语：刚开始写博客，如有疏漏或者错误之处，欢迎留言指正。</p></blockquote>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;很久之前就想写一篇关于3D Touch的博客，因为各种原因一直到现在才开始写(其实就是懒&amp;gt;_&amp;lt;)。咳咳，趁着发呆时间赶紧来写一篇…&lt;a href=&quot;https://github.com/VicoWang/3D-Touch&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;demo请戳这里&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="iOS" scheme="http://yoursite.com/categories/iOS/"/>
    
    
      <category term="iOS" scheme="http://yoursite.com/tags/iOS/"/>
    
  </entry>
  
</feed>
